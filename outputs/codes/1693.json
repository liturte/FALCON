{"1693": {"code": ["in theconformingthe number of floorsof thethenumber of floors inonecan beintheinthetheasof.....].].]. a_i ).. a_i].]. a_i ).", "andtheas large as possible.forthatto benumber ofconstituent.\\leq m_i \\leq 10^9$)\u00a0\u2014.\\leq n \\leq 500\\,000$).a_i$ \\leq\\leq 10^9$)\u00a0\u2014 theof aintheto beof the", "aretoit can bea_i$andthey are required tothey are required to bea_i$a_k$not required to beone of theone ofthea_k$as large as possible,astheof thethethethethethetheofthe system. This codethe number offloors", "theof thethethe number ofto beof aofoftheof theina_j,and $k$ are all.of thethethein the abovethe abovethethethe. a_i = 1.0 ;of a _i$of athe number of floorsto bethe max number ofof the", "of thethe number ofas large as possiblein athatthe number of floorssocanof thethe number ofin aand theofthe number of$j$ $k$ $a_j$k$ $a_i $\u00a0\u2014 thenumber ofplan, so thatthethethetheof thethe//of the", "so thatitthe( a_j$>a_jthe maximum number ofoneof anumber ofof theso thatthenumber ofof thea_j,the number ofto be as large asconstituenttheof a specificthethetheis notthe number of floors in", ". This isoftheto be asthe= m_1,$n$ofthe number ofto be as large asthe number oftheofthe number ofof the(n\\leq n \\leq 500\\,000$)\u00a0\u2014 thenumber of floors for atoto be asof thetheof\\leq n", "inas large as possible.number ofoneof theinthetheto betheinof theanothernumber ofofofthe number ofthea_j, a_k$, $j$, $k$,m_iallof thethethe number oftheof the giventhe number ofa_j, a_", "in thethenof thethenumber oftheofof thethein a\\leq m_ithe number ofof thetheoftheof theof theof theof thetheof theof theitthe number of floorstheof theto beof thetheof thetheof thethe", "the number oftheofso thatthe number of{\\leq n \\leq 500\\,000$)\u00a0\u2014a_i $=\\leq m_i \\leq 10^9$)\u00a0\u2014the number ofthethe number ofofthe number of\\leq 10^9$)\u00a0\u2014 thenumber of"], "prompt": "\nQUESTION:\nThis is a harder version of the problem. In this version $n \\le 500\\,000$\n\nThe outskirts of the capital are being actively built up in Berland. The company \"Kernel Panic\" manages the construction of a residential complex of skyscrapers in New Berlskva. All skyscrapers are built along the highway. It is known that the company has already bought $n$ plots along the highway and is preparing to build $n$ skyscrapers, one skyscraper per plot.\n\nArchitects must consider several requirements when planning a skyscraper. Firstly, since the land on each plot has different properties, each skyscraper has a limit on the largest number of floors it can have. Secondly, according to the design code of the city, it is unacceptable for a skyscraper to simultaneously have higher skyscrapers both to the left and to the right of it.\n\nFormally, let's number the plots from $1$ to $n$. Then if the skyscraper on the $i$-th plot has $a_i$ floors, it must hold that $a_i$ is at most $m_i$ ($1 \\le a_i \\le m_i$). Also there mustn't be integers $j$ and $k$ such that $j < i < k$ and $a_j > a_i < a_k$. Plots $j$ and $k$ are not required to be adjacent to $i$.\n\nThe company wants the total number of floors in the built skyscrapers to be as large as possible. Help it to choose the number of floors for each skyscraper in an optimal way, i.e. in such a way that all requirements are fulfilled, and among all such construction plans choose any plan with the maximum possible total number of floors.\n\n\n-----Input-----\n\nThe first line contains a single integer $n$ ($1 \\leq n \\leq 500\\,000$)\u00a0\u2014 the number of plots.\n\nThe second line contains the integers $m_1, m_2, \\ldots, m_n$ ($1 \\leq m_i \\leq 10^9$)\u00a0\u2014 the limit on the number of floors for every possible number of floors for a skyscraper on each plot.\n\n\n-----Output-----\n\nPrint $n$ integers $a_i$\u00a0\u2014 the number of floors in the plan for each skyscraper, such that all requirements are met, and the total number of floors in all skyscrapers is the maximum possible.\n\nIf there are multiple answers possible, print any of them.\n\n\n-----Examples-----\nInput\n5\n1 2 3 2 1\n\nOutput\n1 2 3 2 1 \n\nInput\n3\n10 6 8\n\nOutput\n10 6 6 \n\n\n\n-----Note-----\n\nIn the first example, you can build all skyscrapers with the highest possible height.\n\nIn the second test example, you cannot give the maximum height to all skyscrapers as this violates the design code restriction. The answer $[10, 6, 6]$ is optimal. Note that the answer of $[6, 6, 8]$ also satisfies all restrictions, but is not optimal.\nUse Standard Input format\nANSWER:\n"}}