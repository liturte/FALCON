{"3992": {"code": ["thechocolate pieces., $kchocolate pieces in then ofchocolate pieces inthe$n$ of$i$-th box contains\\lethe chocolate pieces inthe$i$-th box$i$-th box contains $n$empty boxes,thethe chocolate pieces inthethe$1,n of ch", "Alice happy, printof abebe happythe$i$-th boxthe$i$-th box,theof theof theofand the $n$ of$n$ ofthe chocolate pieces intheofof the$i$-th box,inof the $n$thethe $n$thethe", "be()$k $ofof the chocolatetotheempty boxes,(inthe first line contains1$ $i$-th boxthe(inthe chocolatethe(ififthe chocolate pieces(inthese boxes exist,all ofthethe number of chocolate pieces$n$ is(n$", "1$ and $kif there exists{a_i \\le 10^6$)\u00a0\u2014$k(AliceAlice happy, print $-1$$k+1$,\\le n \\le 10^6$)\u00a0\u2014 the$n$the$1$, $n$$0\\le\\le a_i \\le", "()  public( ).).( ).( )..( )( ) ; })( ).) ).( )( ).). add (). add (( ). add ()). add ()( ). add (). add (. add (). add ())", "atoof $n$of($n$0 )number of chocolate pieces inempty box, andthe{\\le n\\le\\le 10^6$)\u00a0\u2014 the number ofchocolate pieces in thea_2, \\ldots,$0, \\le a_i,\\le 10^6$)\u00a0\ufffd", "AliceAlice=$n$ $1$ $n$a_2, \\ldots, a_n$ isof $n$$i$-th boxofthethea_i$ chocolate pieces,isthe chocolate pieces in$1$, a_2, \\ldots,number of$i$-th boxthe first$1", "Alice happyin,of., \"Alice\": \"Alice\", \"Alice\"\"Alice\", \"Alice\", \"Alice\", \"Alice\", \"Alice\", \"Alice\"\"Alice\",, \"Alice\", \"Alice\", \"Alice\", \"Alice\", \"Alice\",", "achocolate pieces in the $i$of theAlice happy$n$ emptythebe$i$-th box,$i$-th box,and $i$-th box,.)]; for ( var$k =[ 0 ] ;] ;] =] ;[ 1 ] ;] = $k ;[ 1 ]", "$n$thehappy.= 0 ; i <a_1,$0, a_2,a_n$ is$-1$.happy. Alicehappy. Alicehappy, print $-1$.0is$1$.int n$$ $k1$=$k1$ $k1$ $n"], "prompt": "\nQUESTION:\nThis is the harder version of the problem. In this version, $1 \\le n \\le 10^6$ and $0 \\leq a_i \\leq 10^6$. You can hack this problem if you locked it. But you can hack the previous problem only if you locked both problems\n\nChristmas is coming, and our protagonist, Bob, is preparing a spectacular present for his long-time best friend Alice. This year, he decides to prepare $n$ boxes of chocolate, numbered from $1$ to $n$. Initially, the $i$-th box contains $a_i$ chocolate pieces.\n\nSince Bob is a typical nice guy, he will not send Alice $n$ empty boxes. In other words, at least one of $a_1, a_2, \\ldots, a_n$ is positive. Since Alice dislikes coprime sets, she will be happy only if there exists some integer $k > 1$ such that the number of pieces in each box is divisible by $k$. Note that Alice won't mind if there exists some empty boxes. \n\nCharlie, Alice's boyfriend, also is Bob's second best friend, so he decides to help Bob by rearranging the chocolate pieces. In one second, Charlie can pick up a piece in box $i$ and put it into either box $i-1$ or box $i+1$ (if such boxes exist). Of course, he wants to help his friend as quickly as possible. Therefore, he asks you to calculate the minimum number of seconds he would need to make Alice happy.\n\n\n-----Input-----\n\nThe first line contains a single integer $n$ ($1 \\le n \\le 10^6$)\u00a0\u2014 the number of chocolate boxes.\n\nThe second line contains $n$ integers $a_1, a_2, \\ldots, a_n$ ($0 \\le a_i \\le 10^6$)\u00a0\u2014 the number of chocolate pieces in the $i$-th box.\n\nIt is guaranteed that at least one of $a_1, a_2, \\ldots, a_n$ is positive.\n\n\n-----Output-----\n\nIf there is no way for Charlie to make Alice happy, print $-1$.\n\nOtherwise, print a single integer $x$\u00a0\u2014 the minimum number of seconds for Charlie to help Bob make Alice happy.\n\n\n-----Examples-----\nInput\n3\n4 8 5\n\nOutput\n9\n\nInput\n5\n3 10 2 1 5\n\nOutput\n2\n\nInput\n4\n0 5 15 10\n\nOutput\n0\n\nInput\n1\n1\n\nOutput\n-1\n\n\n\n-----Note-----\n\nIn the first example, Charlie can move all chocolate pieces to the second box. Each box will be divisible by $17$.\n\nIn the second example, Charlie can move a piece from box $2$ to box $3$ and a piece from box $4$ to box $5$. Each box will be divisible by $3$.\n\nIn the third example, each box is already divisible by $5$.\n\nIn the fourth example, since Charlie has no available move, he cannot help Bob make Alice happy.\nUse Standard Input format\nANSWER:\n"}}