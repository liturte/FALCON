{"2094": {"code": ["thequestion $3$$5$, $1$ and $2$$n$ is$1$, $2$$0$ points.of$3$,theaquestion $4$, the answeris$n$$1$$3$, and the$4$ points. $5$ isthe$7$$5$,$0", "aofthe answer suit is $a[$i$$h$ $a$ earns$1$ points$n$ pointsthe$i$ $2$$k^n$theandthe answeris $n$1$,$2$ points $3$,$1$$1$ points, $i$the$2$$3$", "$k$of the$h_1$, $h_2$,$h_1$, $h_3$,the$4$of the answerquestion $4$,$4$ points. Since $1$h_1$, $h_2$$3$, $4$$3$, $4$$4$, $4$ $4$ $", "$2$, $4$, $4$, $5$,$2$, $4$,thethe answerto thethe $n$$1$$2$$3$, $4$,$2$, the $1$$4$ points, the$4$ points. $n$ is$4$ points.the answer suitinthe answer", "$1$if you=inyouanswer suit $a$$a'$ earns $1$ point and$a'$ earnsyou$k^n$$2$ points.$n$$3$the answer suit $a'$ earns $4$$1$$1$ points.the$4$ points. The$5$", "$n$ answer suits is$n$ point.$a$ earns$4$ points.$a$ earns $4$ points.$a'$ earns$1$ point and the answerthe$h_{i}$, andthe$i$ is $h_{i}$, and$h_{i}$the answer $1$ point,$0$ points.", "$3$ andthe answer suit is$2$$4$ points. The$4$ points.$1$$4$ points. Theand theit is not$5$youthethe answer suit $a'$ earnspoints. Thethe answer$a'$ earns$5$ points. Thethethe$2$$2$", ".$1$$2$ $2$$3$$4$$2$ $3$$4$ points. If thea$4$ points.$4$ points. The\\bmod n + 1$1$ $1$the answerpoints$3$,$2$,...,$4$the$5$ points. $5$ points", "they areof the answerthe answer suitthe$2$,the$3$, $4$be counted.$a$ earns $4$$4$ points.the$4$ points, $4$$4$ points. $3$$1$ point, $4$the$a'$ earns $4$ points.$4$ points", "$h_1, $h_2,$3$,...,$2$,$3$, $4$, $0$,the$a$ earns$4$ points. Thethe answer suit$4$$5$ $3$ $4$$1$ $2$ $3$$1$ $2$ $3$$4$$4"], "prompt": "\nQUESTION:\nYour program fails again. This time it gets \"Wrong answer on test 233\".\n\nThis is the harder version of the problem. In this version, $1 \\le n \\le 2\\cdot10^5$. You can hack this problem if you locked it. But you can hack the previous problem only if you locked both problems.\n\nThe problem is to finish $n$ one-choice-questions. Each of the questions contains $k$ options, and only one of them is correct. The answer to the $i$-th question is $h_{i}$, and if your answer of the question $i$ is $h_{i}$, you earn $1$ point, otherwise, you earn $0$ points for this question. The values $h_1, h_2, \\dots, h_n$ are known to you in this problem.\n\nHowever, you have a mistake in your program. It moves the answer clockwise! Consider all the $n$ answers are written in a circle. Due to the mistake in your program, they are shifted by one cyclically.\n\nFormally, the mistake moves the answer for the question $i$ to the question $i \\bmod n + 1$. So it moves the answer for the question $1$ to question $2$, the answer for the question $2$ to the question $3$, ..., the answer for the question $n$ to the question $1$.\n\nWe call all the $n$ answers together an answer suit. There are $k^n$ possible answer suits in total.\n\nYou're wondering, how many answer suits satisfy the following condition: after moving clockwise by $1$, the total number of points of the new answer suit is strictly larger than the number of points of the old one. You need to find the answer modulo $998\\,244\\,353$.\n\nFor example, if $n = 5$, and your answer suit is $a=[1,2,3,4,5]$, it will submitted as $a'=[5,1,2,3,4]$ because of a mistake. If the correct answer suit is $h=[5,2,2,3,4]$, the answer suit $a$ earns $1$ point and the answer suite $a'$ earns $4$ points. Since $4 > 1$, the answer suit $a=[1,2,3,4,5]$ should be counted.\n\n\n-----Input-----\n\nThe first line contains two integers $n$, $k$ ($1 \\le n \\le 2\\cdot10^5$, $1 \\le k \\le 10^9$)\u00a0\u2014 the number of questions and the number of possible answers to each question.\n\nThe following line contains $n$ integers $h_1, h_2, \\dots, h_n$, ($1 \\le h_{i} \\le k)$\u00a0\u2014 answers to the questions.\n\n\n-----Output-----\n\nOutput one integer: the number of answers suits satisfying the given condition, modulo $998\\,244\\,353$.\n\n\n-----Examples-----\nInput\n3 3\n1 3 1\n\nOutput\n9\n\nInput\n5 5\n1 1 4 2 2\n\nOutput\n1000\n\nInput\n6 2\n1 1 2 2 1 1\n\nOutput\n16\n\n\n\n-----Note-----\n\nFor the first example, valid answer suits are $[2,1,1], [2,1,2], [2,1,3], [3,1,1], [3,1,2], [3,1,3], [3,2,1], [3,2,2], [3,2,3]$.\nUse Standard Input format\nANSWER:\n"}}