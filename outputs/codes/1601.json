{"1601": {"code": ["is2of thethe$1$, $i$, $z_i$$n$ is\\le x_i,\\le y_i, z_i, $a_i,\\le x_i, y_i, $z_i$$a$, $b_i, $z_i$,$n$,$x_i$, $y_", "$n$$n$$n$ is even.the$n$ is$a$ is$b$ isand $c$ is$a$ and $b$$x_i, $y_i$, $z_i$ $z_i$,$a_i,$n$ isthe$n$ is$a$ $b$ $y$", "$\\frac{n}\\t\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t", "0points arefor the next pointan$n$ is even, denoting the$n$$n$$n$$n$thethepoints are$a$, $b$,thethe two points arethetheof the $a$ and$c$ $\\le x_a,$n$ is even, denoting thethethe", "$n$\\le 5\\le$c$ is$c$ lies within the)$x_i$ $y_i $z_i$a$$b$ $z_i$ $x_i $y_i $z_i$z_i $z_i $z_i $z_i$$x_i $z_i $z_i $x", "the first point isof$n$the$i$-th point0the.( ),).}= 0 ; i< $n$[ i; i ++] ; } }0 ; i ++ )[ i ](.i ] ) )i ].) ;) ;} } else {.", "$\\frac{n}{3}$ points that havebeen removed.1 00 0 0 000 1 1 1 10 00 0 0 0 04 0 0 0 00 0 0 00 0 0 0 00 10 0 00 1 1 11 1 10 1 12 1101 1 12 2 23 0 0", "the problem.  publicnthethe..)0then is not even.the..( ) ;{ for{ if ().0 );{( n,[ 0 ],) ;0 ],} ) ; }", "it istheof thecorresponding pointsof$x_i, y_i, z_i$$n$these two pointspointsa3 0ai $ x_i$x_i $y_i $z_i$$n$ $i$-th point$n$ $i$-th pointapoints in two$n$ $", "one of$\\frac{n}{3}$ points thatbe removedinin the$\\frac{n}{2}$ points$\\frac{n}{3}$ points in theand$\\frac{n}{3}$ points in the$n$theone of$\\frac{n}{3}$0$n$.thethe$\\frac{n}{2}$ points in"], "prompt": "\nQUESTION:\nThis is a harder version of the problem. In this version, $n \\le 50\\,000$.\n\nThere are $n$ distinct points in three-dimensional space numbered from $1$ to $n$. The $i$-th point has coordinates $(x_i, y_i, z_i)$. The number of points $n$ is even.\n\nYou'd like to remove all $n$ points using a sequence of $\\frac{n}{2}$ snaps. In one snap, you can remove any two points $a$ and $b$ that have not been removed yet and form a perfectly balanced pair. A pair of points $a$ and $b$ is perfectly balanced if no other point $c$ (that has not been removed yet) lies within the axis-aligned minimum bounding box of points $a$ and $b$.\n\nFormally, point $c$ lies within the axis-aligned minimum bounding box of points $a$ and $b$ if and only if $\\min(x_a, x_b) \\le x_c \\le \\max(x_a, x_b)$, $\\min(y_a, y_b) \\le y_c \\le \\max(y_a, y_b)$, and $\\min(z_a, z_b) \\le z_c \\le \\max(z_a, z_b)$. Note that the bounding box might be degenerate. \n\nFind a way to remove all points in $\\frac{n}{2}$ snaps.\n\n\n-----Input-----\n\nThe first line contains a single integer $n$ ($2 \\le n \\le 50\\,000$; $n$ is even), denoting the number of points.\n\nEach of the next $n$ lines contains three integers $x_i$, $y_i$, $z_i$ ($-10^8 \\le x_i, y_i, z_i \\le 10^8$), denoting the coordinates of the $i$-th point.\n\nNo two points coincide.\n\n\n-----Output-----\n\nOutput $\\frac{n}{2}$ pairs of integers $a_i, b_i$ ($1 \\le a_i, b_i \\le n$), denoting the indices of points removed on snap $i$. Every integer between $1$ and $n$, inclusive, must appear in your output exactly once.\n\nWe can show that it is always possible to remove all points. If there are many solutions, output any of them.\n\n\n-----Examples-----\nInput\n6\n3 1 0\n0 3 0\n2 2 0\n1 0 0\n1 3 0\n0 1 0\n\nOutput\n3 6\n5 1\n2 4\n\nInput\n8\n0 1 1\n1 0 1\n1 1 0\n1 1 1\n2 2 2\n3 2 2\n2 3 2\n2 2 3\n\nOutput\n4 5\n1 6\n2 7\n3 8\n\n\n\n-----Note-----\n\nIn the first example, here is what points and their corresponding bounding boxes look like (drawn in two dimensions for simplicity, as all points lie on $z = 0$ plane). Note that order of removing matters: for example, points $5$ and $1$ don't form a perfectly balanced pair initially, but they do after point $3$ is removed.  [Image]\nUse Standard Input format\nANSWER:\n"}}