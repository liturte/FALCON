{"2041": {"code": ["1 ]$$n$.thesubsequence is$a[3,4]$ isof$n$.isof thelengthof the long list.$n$, $[3,4,4,4,4,4,4,5]$ is$n$, $[4,4,4,5,6,6,6,7,9,8,9", "$a[$1,a_2, \\dots,a_n]$$a[$1,a_2, \\dots,a_n]$ issubsequence is$[10, 21,$[10, 21,$[10,$[10, 21, 1]$ is$[10, 21, 1]$ is$[10, 21, 0]$ is$[", "$a$of length $k$subsequence isa$a[$i]$ is$[i, i]$ is$a[$i]$ is$a[$i]$ is$a[$i]$ is$[i, i]$ is$a[$i]$ is$a[$i]$ is lexicographically$a[$i]$ is$[0,", "$n$.thethethelength $a$.the subsequencethe subsequence isthe subsequence is$a[$7, 99, 99]$ is$[7, 99, 99]$ is$[7, 99, 99]$ is$[7, 99, 99]$ is$[7, 99, 99]$ is$[7, 99, 99]$ is", "subsequence is( $1 \\le$a$ istheis$a$ issubsequence issubsequence is$a[$k-1]$$b[$k-1]$ is lexicographically larger than$a[$k-1]$ is$b[$t-1]$ is lexicographically smaller than$[k-1]$ is lexicographically smaller than$a", "$a$ isof length$a$$[40,20,20,20]$,$[40,20,20,20,20,20,20,20]$ and $[40,20,20,20,20]$$[40,20,20,20,20]$$[40,20,20,20,20,20,20]$ is$[20,20", "$[a_1,a_2]$ of$[a_1,a_2,$[a_1,a_2,a_n]$,$[a_1,a_2,a_n]$, $[a_1,a_2,a_n]$, $a_1,a_2,a_n]$ is$n$.$a[", "$a$ofoflength $k$.andof$b_1$ $b_2$ $c_1$$c_1$ $c_2$ $c_t$$b_t$ is lexicographically smaller than$a[$a$]$ is$a[$a$]$$a[$a$]$$[a$]$ are not subsequences", "subsequence isofthe sequence $a$ istheof the=$a$$[20]$ isa$[20,20,20,11]$ isofand $[10, 21, 0]$$[10, 21, 0]$ is$[10, 21, 1]$ is$[10, 21, 1]$ isare nota", "$a$$a$ is not subsequencesthe sequence$a$ is$a$ is notasubsequence isis not$a$ is not subsequencesof length $n$.subsequence is$n$$a$ is not subsequences.$a[$n]$ is not subsequences.$n$ isof length $n$.$a[$n]$"], "prompt": "\nQUESTION:\nThis is the harder version of the problem. In this version, $1 \\le n, m \\le 2\\cdot10^5$. You can hack this problem if you locked it. But you can hack the previous problem only if you locked both problems.\n\nYou are given a sequence of integers $a=[a_1,a_2,\\dots,a_n]$ of length $n$. Its subsequence is obtained by removing zero or more elements from the sequence $a$ (they do not necessarily go consecutively). For example, for the sequence $a=[11,20,11,33,11,20,11]$:  $[11,20,11,33,11,20,11]$, $[11,20,11,33,11,20]$, $[11,11,11,11]$, $[20]$, $[33,20]$ are subsequences (these are just some of the long list);  $[40]$, $[33,33]$, $[33,20,20]$, $[20,20,11,11]$ are not subsequences. \n\nSuppose that an additional non-negative integer $k$ ($1 \\le k \\le n$) is given, then the subsequence is called optimal if:  it has a length of $k$ and the sum of its elements is the maximum possible among all subsequences of length $k$;  and among all subsequences of length $k$ that satisfy the previous item, it is lexicographically minimal. \n\nRecall that the sequence $b=[b_1, b_2, \\dots, b_k]$ is lexicographically smaller than the sequence $c=[c_1, c_2, \\dots, c_k]$ if the first element (from the left) in which they differ less in the sequence $b$ than in $c$. Formally: there exists $t$ ($1 \\le t \\le k$) such that $b_1=c_1$, $b_2=c_2$, ..., $b_{t-1}=c_{t-1}$ and at the same time $b_t<c_t$. For example:  $[10, 20, 20]$ lexicographically less than $[10, 21, 1]$,  $[7, 99, 99]$ is lexicographically less than $[10, 21, 1]$,  $[10, 21, 0]$ is lexicographically less than $[10, 21, 1]$. \n\nYou are given a sequence of $a=[a_1,a_2,\\dots,a_n]$ and $m$ requests, each consisting of two numbers $k_j$ and $pos_j$ ($1 \\le k \\le n$, $1 \\le pos_j \\le k_j$). For each query, print the value that is in the index $pos_j$ of the optimal subsequence of the given sequence $a$ for $k=k_j$.\n\nFor example, if $n=4$, $a=[10,20,30,20]$, $k_j=2$, then the optimal subsequence is $[20,30]$ \u2014 it is the minimum lexicographically among all subsequences of length $2$ with the maximum total sum of items. Thus, the answer to the request $k_j=2$, $pos_j=1$ is the number $20$, and the answer to the request $k_j=2$, $pos_j=2$ is the number $30$.\n\n\n-----Input-----\n\nThe first line contains an integer $n$ ($1 \\le n \\le 2\\cdot10^5$) \u2014 the length of the sequence $a$.\n\nThe second line contains elements of the sequence $a$: integer numbers $a_1, a_2, \\dots, a_n$ ($1 \\le a_i \\le 10^9$).\n\nThe third line contains an integer $m$ ($1 \\le m \\le 2\\cdot10^5$) \u2014 the number of requests.\n\nThe following $m$ lines contain pairs of integers $k_j$ and $pos_j$ ($1 \\le k \\le n$, $1 \\le pos_j \\le k_j$) \u2014 the requests.\n\n\n-----Output-----\n\nPrint $m$ integers $r_1, r_2, \\dots, r_m$ ($1 \\le r_j \\le 10^9$) one per line: answers to the requests in the order they appear in the input. The value of $r_j$ should be equal to the value contained in the position $pos_j$ of the optimal subsequence for $k=k_j$.\n\n\n-----Examples-----\nInput\n3\n10 20 10\n6\n1 1\n2 1\n2 2\n3 1\n3 2\n3 3\n\nOutput\n20\n10\n20\n10\n20\n10\n\nInput\n7\n1 2 1 3 1 2 1\n9\n2 1\n2 2\n3 1\n3 2\n3 3\n1 1\n7 1\n7 7\n7 4\n\nOutput\n2\n3\n2\n3\n2\n3\n1\n1\n3\n\n\n\n-----Note-----\n\nIn the first example, for $a=[10,20,10]$ the optimal subsequences are:   for $k=1$: $[20]$,  for $k=2$: $[10,20]$,  for $k=3$: $[10,20,10]$.\nUse Standard Input format\nANSWER:\n"}}