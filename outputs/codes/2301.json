{"2301": {"code": ["$n$one sphere forSage will$2$they are notthesphere forthe spheresSage willforthey are not$a_1, a_2, \\dots, a_n$ $(1 \\le\\le 10^9)$\u00a0\u2014 the numberof theofyou cantheto theto the\\le", "theitof thecan buythe.( 1,) {ifthe..) )Sage...) ;.) ;. add (].( ) ;) ;. add. add (; } }", "., $n$n$ $a_1, a_2,n$ integer $n$ $a_n$the..............].. ice... ice... ice.. ice. ice", "version of the problem.Sage isone of.ofone of the:::: \"A\"\"B\": \"A\", \"C\"\"C\", \"C\", \"C\"\"A\", \"C\", \"C\", \"C\", \"C\", \"C\", \"C\",\"C\", \"C\"\"", "a single integer $a_15 -Sage woulda positive integerit's not possible tothesphere$a_1, $a_2, $a_iif,\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n", "aSageSage can buytheyoutheyou cana single integerthethesphere for $1$ and $2$spheretwospherethetotheit's not possible to placeof thetheis not possiblesphere$n$ $a_1$ and $n$sphere for $1$theto be the", "theit$n$ integerof $a_1$ and $a_2$Sage will buythe\\dots, a_n$ $(1\\dots, a_n$ $(1\\le 10^9)$\u00a0\u2014 theof thethesphere$n$ integer $a_1$$n$ integer $a_2$ integerthesph", "thein thethe product in thethe product inthe product in theyou canthe product inthe product in thethe product in thethe product inof the product.the product inthe product inthe product isthe product inthe producttheSagethe productin the product.the product in thethe product in theSagetoSagethe product", "sphere $n$if youaistheof theyou:the..sphere issphere is a= new( ) ;.).{]spherespheresphere,;..sphere. numbered from the", "thethethesphere $a_1 $n$toSage$n$$a_1\\dots, a_n$ $(1 \\lethethesphere is..= new.Sage...].]... spheres ). spheres [spheres. length,,"], "prompt": "\nQUESTION:\nThis is the hard version of the problem. The difference between the versions is that in the easy version all prices $a_i$ are different. You can make hacks if and only if you solved both versions of the problem.\n\nToday is Sage's birthday, and she will go shopping to buy ice spheres. All $n$ ice spheres are placed in a row and they are numbered from $1$ to $n$ from left to right. Each ice sphere has a positive integer price. In this version, some prices can be equal.\n\nAn ice sphere is cheap if it costs strictly less than two neighboring ice spheres: the nearest to the left and the nearest to the right. The leftmost and the rightmost ice spheres are not cheap. Sage will choose all cheap ice spheres and then buy only them.\n\nYou can visit the shop before Sage and reorder the ice spheres as you wish. Find out the maximum number of ice spheres that Sage can buy, and show how the ice spheres should be reordered.\n\n\n-----Input-----\n\nThe first line contains a single integer $n$ $(1 \\le n \\le 10^5)$\u00a0\u2014 the number of ice spheres in the shop.\n\nThe second line contains $n$ integers $a_1, a_2, \\dots, a_n$ $(1 \\le a_i \\le 10^9)$\u00a0\u2014 the prices of ice spheres.\n\n\n-----Output-----\n\nIn the first line print the maximum number of ice spheres that Sage can buy.\n\nIn the second line print the prices of ice spheres in the optimal order. If there are several correct answers, you can print any of them.\n\n\n-----Example-----\nInput\n7\n1 3 2 2 4 5 4\n\nOutput\n3\n3 1 4 2 4 2 5 \n\n\n-----Note-----\n\nIn the sample it's not possible to place the ice spheres in any order so that Sage would buy $4$ of them. If the spheres are placed in the order $(3, 1, 4, 2, 4, 2, 5)$, then Sage will buy one sphere for $1$ and two spheres for $2$ each.\nUse Standard Input format\nANSWER:\n"}}