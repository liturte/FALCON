{"4630": {"code": ["$p_2,$2$-th$2$-ththe $1$-stthe $1$-st$n$ is a$i$ is atheto the$p_2, the$p_2, thethe $p_i$.for)=; i <i < n ;i ++ ).].", "the$i$ - th$1$-th$p_1$ toof $n$thethethe$i$-th child$n$the $i$-th childis used toof thefor thethe $i$-th childof the$i$-thto the$p_1$of $i$the first timethe", "$p_1$ to $p_2$of the $p_1$the$p_1$the$n$the$p_1$ is the numberof the $i$thethe $p_i$ of thethethe$n$ is the$p_1,the$p_2,$n$ is the number oftheof", "$n$ isthe $p_i$they arethe first$1$-stof the$i$-th$n$ is a$i$-th$n$ is$i$-ththeof theof the$n$ is aat the end of$n$ is a$i$the $i$-thof$p", "$i$$n$thetheof the $fourth$i$-th child$n$the$p_1$$n$ $i$in the$i$-th child is returned toof thein thetheatthein$i$the first timethethe$f$-th child is returnedto him.", "$p_1the firstand $i$the$p_1the$p_1$ $p_2, $i$the$p_1$$i$to the first$n$$n$of thein the $i$ to $n$.ofthe$i$ to $n$$p_1$the firstthe first", "the first timethe$q$ queries follow.the$1$-st$i$theof thethe $i$-th childthe first$n$$n$$p_1, p_2, p_3, p_4,$p_4, p_5,for thethe first$q$ queries follow.$n$of the", "and$i$ will have athe $n$to the $i$thethe firstof the$1$-stday it willittheis athe$i$to the$i$$i$ will$n$of $p_2, $p_3,the$2$-th$p_2,$i$ to", "the firstof the$n$ $i$thefor the$i$ - thtellsthetheof theof thethe$i$of the $i$thethethe $i$-thofof the$p_1the$p_2,the $i$-th child is returnedthethe $p$the", "the$i$$i$theis$n$$n$the firstto the$q$ queries follow.  public( )).).0 ]..]] )..[ 1 ]]( )2 ].) ) ).= p_i= p_i."], "prompt": "\nQUESTION:\nThe only difference between easy and hard versions is constraints.\n\nThere are $n$ kids, each of them is reading a unique book. At the end of any day, the $i$-th kid will give his book to the $p_i$-th kid (in case of $i = p_i$ the kid will give his book to himself). It is guaranteed that all values of $p_i$ are distinct integers from $1$ to $n$ (i.e. $p$ is a permutation). The sequence $p$ doesn't change from day to day, it is fixed.\n\nFor example, if $n=6$ and $p=[4, 6, 1, 3, 5, 2]$ then at the end of the first day the book of the $1$-st kid will belong to the $4$-th kid, the $2$-nd kid will belong to the $6$-th kid and so on. At the end of the second day the book of the $1$-st kid will belong to the $3$-th kid, the $2$-nd kid will belong to the $2$-th kid and so on.\n\nYour task is to determine the number of the day the book of the $i$-th child is returned back to him for the first time for every $i$ from $1$ to $n$.\n\nConsider the following example: $p = [5, 1, 2, 4, 3]$. The book of the $1$-st kid will be passed to the following kids:  after the $1$-st day it will belong to the $5$-th kid,  after the $2$-nd day it will belong to the $3$-rd kid,  after the $3$-rd day it will belong to the $2$-nd kid,  after the $4$-th day it will belong to the $1$-st kid. \n\nSo after the fourth day, the book of the first kid will return to its owner. The book of the fourth kid will return to him for the first time after exactly one day.\n\nYou have to answer $q$ independent queries.\n\n\n-----Input-----\n\nThe first line of the input contains one integer $q$ ($1 \\le q \\le 1000$) \u2014 the number of queries. Then $q$ queries follow.\n\nThe first line of the query contains one integer $n$ ($1 \\le n \\le 2 \\cdot 10^5$) \u2014 the number of kids in the query. The second line of the query contains $n$ integers $p_1, p_2, \\dots, p_n$ ($1 \\le p_i \\le n$, all $p_i$ are distinct, i.e. $p$ is a permutation), where $p_i$ is the kid which will get the book of the $i$-th kid.\n\nIt is guaranteed that $\\sum n \\le 2 \\cdot 10^5$ (sum of $n$ over all queries does not exceed $2 \\cdot 10^5$).\n\n\n-----Output-----\n\nFor each query, print the answer on it: $n$ integers $a_1, a_2, \\dots, a_n$, where $a_i$ is the number of the day the book of the $i$-th child is returned back to him for the first time in this query.\n\n\n-----Example-----\nInput\n6\n5\n1 2 3 4 5\n3\n2 3 1\n6\n4 6 2 1 5 3\n1\n1\n4\n3 4 1 2\n5\n5 1 2 4 3\n\nOutput\n1 1 1 1 1 \n3 3 3 \n2 3 3 2 1 3 \n1 \n2 2 2 2 \n4 4 4 1 4\nUse Standard Input format\nANSWER:\n"}}